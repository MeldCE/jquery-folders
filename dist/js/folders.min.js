jQuery&&function(i){i.extend(i.fn,{folders:function(){function t(i,t,s){var e=Array.prototype.slice.call(arguments);return e.splice(0,3),function(){if(s){var l=[].concat(e);l=l.concat(Array.prototype.slice.call(arguments)),i.apply(t,l)}else i.apply(t,e)}}function s(i,t){t.error||e(i.children("div"),t)}function e(t,s,e){var a,n,o=!1;t.children("div").has("ul").length?(o=!0,n=t.children("div").children("ul")):t.children("div").html(n=i("<ul></ul>"));for(a in s)l.apply(this,[n,s[a],e])}function l(s,e,l){var h,c;s.append(h=i("<li></li>")),h.append(c=i("<label>"+e.label+"</label>")),this.options.name,h.attr("data-id",e.id),h.click(t(n,this,!0,h,e)),e._obj=h,this.options.create&&(h.append(createLink=i("<a>New</a>")),createLink.click(t(o,this,!0,h,e.id))),e.sub&&a.apply(this,[h,e.sub,l])}function a(s,l,a){var n,o;s.addClass("parent"),s.append(n=i("<span>+</span>")),s.append(o=i("<div></div>")),n.click(t(c,this,!0,s)),l!==!0&&e.apply(this,[s,l,a+this.options.separator+name])}function n(t,s,e){e.stopPropagation();var l=!1;if(this.selection[s.id]){delete this.selection[s.id],t.removeClass(this.options.selectedClass);var a=this;t.parents().each(function(){return i(this).is(a.div)?!1:i(this).find("."+a.options.selectedClass).length?!1:void i(this).removeClass("childSelected")})}else{if(l=!0,t.addClass(this.options.selectedClass),this.options.multiple){var a=this;t.parents().each(function(){return i(this).is(a.div)?!1:void(i(this).is("li")&&i(this).addClass("childSelected"))})}else{if(this.selection){var n;for(n in this.selection)this.options.selectedClass&&this.selection[n]._obj&&this.selection[n]._obj.removeClass(this.options.selectedClass),delete this.selection[n]}c.apply(this,[this.div,null,!1])}this.selection[s.id]=s}this.options.name;var n,o=0;for(n in this.selection)o++;switch(o){case 0:this.mainLabel.text(this.options.selectLabel);break;case 1:this.mainLabel.text(this.selection[n].label+" selected");break;default:this.mainLabel.text(o+" folders selected")}if(this.options.selection){var n,l=[];for(n in this.selection)l.push(this.selection[n]);this.options.selection(l)}}function o(s,e,l){l.stopPropagation();var a;if(a=prompt("Please enter a name for the new folder")){var n={a:"create",name:a};e&&(n.id=e),i.post(this.options.ajaxScript,n,t(h,this,!0,s,a))}}function h(i,t,s){return s.error?void alert(s.error):(i.hasClass("parent")||i.attr("data-id")&&a(i,!0),void c(i,null,!0,[{label:t,id:s.id}]))}function c(l,a,n,o){if(a&&a.stopPropagation(),l.hasClass("expand")&&n!==!0)l.removeClass("expand"),l.children("span").html("+");else if(n!==!1&&(l.children("span").html("-"),this.options.collapseSiblings&&(l.siblings("li").removeClass("expand"),l.siblings("li").children("span").html("+")),l.addClass("expand"),!l.children("div").has("ul").length||o)){if(o)e(l,o);else{if(!this.options.ajaxScript)return;l.children("div").html(this.options.loadingLabel),i.post(this.options.ajaxScript,{id:l.attr("data-id")},t(s,this,!0,l))}}}function d(t){i(t.target).parents().is(this.obj)||c.apply(this,[this.div,null,!1])}function r(s,l){this.options=i.extend({loadingLabel:"Loading...",selectLabel:"Select a folder",multiple:!1,create:!1,separator:"/",collapseSiblings:!0,"class":"jFolders"},l),this.options.selectedClass||(this.options.selectedClass="selected"),this.obj=s,this.selection={},this.options.class&&s.addClass(this.options.class),s.append(this.div=i("<div></div>")),this.div.html(this.mainLabel=i("<label>"+this.options.selectLabel+"</label>")),this.options.create&&this.obj.append(createLink=i("<a>New</a>").click(t(o,this,!0,this.div,null))),this.div.append(i("<div></div>")),this.div.click(t(c,this,!0,this.div)),this.options.files&&e.apply(this,[this.div,this.options.files]),i(document).on("click",t(d,this,!0))}return function(t,s){i(this).each(function(){new r(i(this),t,s)})}}()})}(jQuery);